<!DOCTYPE html>
<html lang="pt-br">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>IVAD TROCAS E VENDAS</title>
<style>
:root{
  --card-bg: rgba(0,0,0,0.62);
  --btn-gradient: linear-gradient(90deg,#ffd54f,#ffb300);
  --btn-blue: linear-gradient(90deg,#90caf9,#42a5f5);
  --btn-red: linear-gradient(90deg,#ef9a9a,#e57373);
}
html,body{height:100%;margin:0;font-family:Arial,Helvetica,sans-serif;color:#fff;background:#000}
body{perspective:1000px;overflow-x:hidden}
.bg3d{
  position:fixed;inset:0;background:url('/* LINK RAW IMAGEM */') no-repeat center center;
  background-size:cover;z-index:-2;filter:contrast(0.92) saturate(0.95) brightness(0.9);
  transform-origin:center center;animation:float3d 18s ease-in-out infinite alternate;
}
@keyframes float3d{
  0%{transform:translateZ(0px) rotateY(0deg) rotateX(0deg) scale(1)}
  50%{transform:translateZ(12px) rotateY(2deg) rotateX(1deg) scale(1.01)}
  100%{transform:translateZ(0px) rotateY(-1deg) rotateX(-1deg) scale(1)}
}
.overlay{position:fixed;inset:0;z-index:-1;background:linear-gradient(135deg, rgba(0,0,0,0.55), rgba(0,0,0,0.35))}
header{background:rgba(0,0,0,0.6);padding:1rem;text-align:center;position:relative;z-index:2}
header h1{margin:.2rem;font-size:1.4rem}
header p{margin:.1rem;color:#ddd;font-size:0.85rem}
.container{max-width:1000px;margin:1rem auto;padding:1rem;display:grid;grid-template-columns:280px 1fr;gap:1rem}
.card{background:var(--card-bg);padding:1rem;border-radius:10px;box-shadow:0 6px 18px rgba(0,0,0,0.5)}
.menu button{display:block;width:100%;margin-bottom:.8rem;padding:.8rem 1rem;border-radius:8px;border:none;background:#fff;color:#111;font-weight:700;cursor:pointer;transition:transform .15s,box-shadow .15s}
.menu button:hover{transform:translateY(-3px);box-shadow:0 8px 20px rgba(0,0,0,0.35)}
.menu button.active{background:linear-gradient(90deg,#fff,#f0f0f0);color:#000}
.content h2{margin-top:0}
ul{padding-left:1.25rem}
.btn{display:inline-block;padding:.6rem 1rem;border-radius:8px;border:none;background:var(--btn-gradient);color:#111;font-weight:700;cursor:pointer}
.small{font-size:.85rem;color:#ddd}
.top-row{display:flex;gap:1rem;align-items:center;flex-wrap:wrap}
input[type="text"],input[type="password"],input[type=number],select{width:100%;padding:.6rem;margin:.45rem 0;border-radius:8px;border:1px solid rgba(255,255,255,0.12);background:rgba(255,255,255,0.04);color:#fff}
.rank-list{max-height:420px;overflow:auto}
footer{padding:1rem;text-align:center;color:#ccc}
@media(max-width:880px){ .container{grid-template-columns:1fr; padding:.5rem} .menu{order:2} }
.chat-box{max-height:200px;overflow:auto;background:rgba(255,255,255,0.05);padding:.5rem;margin-top:.5rem;border-radius:8px}
.chat-msg{margin:.25rem 0}
</style>
</head>
<body>
<div class="bg3d" aria-hidden="true"></div>
<div class="overlay" aria-hidden="true"></div>

<header>
  <h1>IVAD TROCAS E VENDAS</h1>
  <p>Criado por IVADCREATOR</p>
</header>

<main class="container">
  <aside class="card menu">
    <button class="tabbtn active" data-tab="regrasTab">REGRAS</button>
    <button class="tabbtn" data-tab="jogoTab">üéÆ JOGUINHO</button>
    <button class="tabbtn" data-tab="rankTab">üèÜ RANK GLOBAL</button>
    <button class="tabbtn" data-tab="chatTab">üí¨ CHAT</button>
    <hr style="border:none;height:1px;background:rgba(255,255,255,0.06);margin:10px 0">

    <!-- LOGIN / SIGNUP -->
    <div id="authArea" class="small">
      <div id="signedOutUI">
        <input id="username" type="text" placeholder="Escolha um nome (sem espa√ßos)">
        <input id="pwd" type="password" placeholder="Senha (‚â•6)">
        <div style="display:flex;gap:.5rem">
          <button id="btnSignup" class="btn" style="background:var(--btn-blue)">Criar conta</button>
          <button id="btnLogin" class="btn">Entrar</button>
        </div>
        <p class="small">Nome √∫nico ‚Äî se j√° existir, escolha outro.</p>
      </div>

      <div id="signedInUI" style="display:none">
        <p><strong id="userLabel"></strong></p>
        <div style="display:flex;gap:.5rem;align-items:center">
          <button id="btnLogout" class="btn" style="background:var(--btn-red)">Sair</button>
          <div style="margin-left:auto"><span class="small">Gold: </span><strong id="myGold">0</strong></div>
        </div>
      </div>
    </div>

    <hr style="border:none;height:1px;background:rgba(255,255,255,0.06);margin:10px 0">
    <div id="ownerPanel" style="display:none">
      <h4 style="margin:.3rem 0">Painel do Dono</h4>
      <input id="adminName" placeholder="nome do usu√°rio (exact)">
      <input id="adminAmount" type="number" placeholder="gold (positivo/negativo)">
      <button id="btnGive" class="btn">Dar/Remover gold</button>
      <button id="btnReset" class="btn" style="background:var(--btn-red);margin-top:.5rem">Resetar ranking</button>
      <p class="small">Somente OWNER_UID pode usar</p>
    </div>
    <hr style="border:none;height:1px;background:rgba(255,255,255,0.06);margin:10px 0">
    <p class="small">Ranking p√∫blico salvo no Firestore.</p>
    <p class="small">Visitantes: <strong id="visitorCount">0</strong></p>
  </aside>

  <section class="card content">
    <div id="regrasTab">
      <h2>Regras</h2>
      <h3>üö´ Proibido</h3>
      <ul>
        <li>Flodar mensagens (spam).</li>
        <li>Compartilhar links suspeitos (pornografia, v√≠rus, phishing, etc.).</li>
        <li>Colocar pre√ßo ou valor em contas de outras pessoas.</li>
        <li>Ofensas, xingamentos ou desrespeito entre membros.</li>
        <li>Vendas de itens ilegais, roubados ou que violem regras.</li>
      </ul>
      <h3>‚úÖ Permitido</h3>
      <ul>
        <li>Postar links (n√£o suspeitos).</li>
        <li>Comprar e vender produtos de forma clara e respeitosa.</li>
        <li>Negociar e interagir com bom senso.</li>
      </ul>
      <h3>‚ö†Ô∏è Observa√ß√µes</h3>
      <ul>
        <li>Descumprimento pode levar a banimento.</li>
        <li>Negocia√ß√µes s√£o responsabilidade entre partes.</li>
        <li>Chat √© moderado automaticamente pelo Firestore ‚Äî respeite todos.</li>
      </ul>
    </div>

    <div id="jogoTab" style="display:none">
      <h2>üéÆ Cassino & Joguinho</h2>
      <p class="small">Clique <strong>Trabalhar</strong> para ganhar <strong>+1 gold</strong>. (Rate-limit: 5s)</p>
      <button id="btnWork" class="btn">Trabalhar (+1 gold)</button>
      <span id="workMsg" class="small" style="margin-left:1rem"></span>

      <h3>Aposta Simples 50/50</h3>
      <input type="number" id="betAmount" placeholder="Quantos golds apostar?" min="1">
      <button id="btnBet" class="btn">Apostar 50/50</button>
      <span id="betMsg" class="small"></span>

      <h3>Aposta Alta</h3>
      <input type="number" id="highBetAmount" placeholder="Quantos golds apostar (chance menor)?" min="1">
      <button id="btnHighBet" class="btn" style="background:var(--btn-red)">Apostar Alta</button>
      <span id="highBetMsg" class="small"></span>

      <div id="playerInfo" style="margin-top:1rem;display:none">
        <p>Jogador: <strong id="playerName"></strong> ‚Äî Gold: <strong id="playerGold">0</strong></p>
      </div>
    </div>

    <div id="rankTab" style="display:none">
      <h2>üèÜ Rank Global</h2>
      <p class="small">Top jogadores (atualiza automaticamente)</p>
      <div class="rank-list card" id="rankList" style="margin-top:1rem"></div>
    </div>

    <div id="chatTab" style="display:none">
      <h2>üí¨ Chat Global</h2>
      <div class="chat-box" id="chatBox"></div>
      <input type="text" id="chatInput" placeholder="Digite sua mensagem" style="margin-top:.5rem">
      <button id="btnSendChat" class="btn">Enviar</button>
    </div>
  </section>
</main>

<footer>¬© 2025 IVAD TROCAS E VENDAS | IVADCREATOR</footer>

<!-- Firebase -->
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-auth-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>

<script>
// =======================
// CONFIGURA√á√ïES FIREBASE
// =======================
const firebaseConfig = /* const firebaseConfig = {
  apiKey: "AIzaSyCkmyMqEJaM8jVvmTN8I3gLnbC8YtMPWOI",
  authDomain: "regras-ivad.firebaseapp.com",
  projectId: "regras-ivad",
  storageBucket: "regras-ivad.firebasestorage.app",
  messagingSenderId: "812565896201",
  appId: "1:812565896201:android:afc3bddd8edb14071aacd8"
}; */;
const OWNER_UID = "m3h06woQv2V7lrNu1p8fDQCZ8IW2";

firebase.initializeApp(firebaseConfig);
const auth = firebase.auth();
const db = firebase.firestore();

// =======================
// ELEMENTOS DO DOM
// =======================
const signedOutUI = document.getElementById('signedOutUI');
const signedInUI = document.getElementById('signedInUI');
const userLabel = document.getElementById('userLabel');
const myGold = document.getElementById('myGold');
const playerName = document.getElementById('playerName');
const playerGold = document.getElementById('playerGold');
const playerInfo = document.getElementById('playerInfo');
const chatBox = document.getElementById('chatBox');
const chatInput = document.getElementById('chatInput');
const rankList = document.getElementById('rankList');
const visitorCounter = document.getElementById('visitorCount');
const workMsg = document.getElementById('workMsg');
const betMsg = document.getElementById('betMsg');

// =======================
// FUN√á√ïES AUXILIARES
// =======================
function showTab(id){
  ['regrasTab','jogoTab','rankTab','chatTab'].forEach(t=>document.getElementById(t).style.display=(t===id?'block':'none'));
}
document.querySelectorAll('.tabbtn').forEach(b=>{
  b.addEventListener('click',e=>{
    document.querySelectorAll('.tabbtn').forEach(x=>x.classList.remove('active'));
    e.currentTarget.classList.add('active');
    showTab(e.currentTarget.dataset.tab);
  });
});
showTab('regrasTab');

function usernameToEmail(u){ return `${u}@ivad.local`; }
function validUsername(u){ return /^[a-zA-Z0-9_]{3,20}$/.test(u); }
function escapeHtml(s){ return String(s).replace(/[&<>"']/g,m=>({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#39;'}[m])); }

// =======================
// AUTENTICA√á√ÉO
// =======================
document.getElementById('btnSignup').onclick = async ()=>{
  const uname = document.getElementById('username').value.trim();
  const pw = document.getElementById('pwd').value;
  if(!validUsername(uname)){ alert('Nome inv√°lido'); return; }
  if(pw.length<6){ alert('Senha precisa ‚â•6'); return; }
  try{
    const q = await db.collection('users').where('displayName','==',uname).limit(1).get();
    if(!q.empty){ alert('Nome j√° existe'); return; }
    const syntheticEmail = usernameToEmail(uname);
    const cred = await auth.createUserWithEmailAndPassword(syntheticEmail,pw);
    const user = cred.user;
    await db.collection('users').doc(user.uid).set({
      uid:user.uid,
      email:syntheticEmail,
      displayName:uname,
      gold:0,
      createdAt:firebase.firestore.FieldValue.serverTimestamp()
    });
    alert('Conta criada! Voc√™ j√° est√° logado.');
  }catch(err){ console.error(err); alert('Erro: '+err.message); }
};

document.getElementById('btnLogin').onclick = async ()=>{
  const uname = document.getElementById('username').value.trim();
  const pw = document.getElementById('pwd').value;
  if(!validUsername(uname)){ alert('Nome inv√°lido'); return; }
  if(pw.length<6){ alert('Senha precisa ‚â•6'); return; }
  try{ await auth.signInWithEmailAndPassword(usernameToEmail(uname), pw); }
  catch(err){ console.error(err); alert('Erro ao entrar: '+err.message); }
};

document.getElementById('btnLogout').onclick = ()=>auth.signOut();

// =======================
// ESTADO DE AUTENTICA√á√ÉO
// =======================
auth.onAuthStateChanged(async user=>{
  if(user){
    signedOutUI.style.display='none';
    signedInUI.style.display='block';
    userLabel.textContent = 'Conectado: '+(user.email?user.email.split('@')[0]:user.uid);
    if(user.uid === OWNER_UID) document.getElementById('ownerPanel').style.display='block';
    else document.getElementById('ownerPanel').style.display='none';
    updateMyInfo(user.uid);
    loadChat();
    reloadRank();
  }else{
    signedOutUI.style.display='block';
    signedInUI.style.display='none';
    document.getElementById('ownerPanel').style.display='none';
    myGold.textContent='0';
    playerInfo.style.display='none';
  }
});

// =======================
// ATUALIZA√á√ÉO DE INFO DO JOGADOR
// =======================
async function updateMyInfo(uid){
  const doc = await db.collection('users').doc(uid).get();
  if(doc.exists){
    const data = doc.data();
    myGold.textContent = data.gold||0;
    playerName.textContent = data.displayName;
    playerGold.textContent = data.gold||0;
    playerInfo.style.display='block';
  }
}

// =======================
// JOGOS
// =======================
let lastWork=0;
document.getElementById('btnWork').onclick=async ()=>{
  const user = auth.currentUser;
  if(!user){ alert('Fa√ßa login'); return; }
  const now = Date.now();
  if(now-lastWork<5000){ workMsg.textContent='Aguarde 5s'; return; }
  lastWork=now;
  try{
    const userRef = db.collection('users').doc(user.uid);
    await db.runTransaction(async tx=>{
      const d = await tx.get(userRef);
      if(!d.exists) throw 'Usu√°rio n√£o encontrado';
      const newGold = (d.data().gold||0)+1;
      tx.update(userRef,{gold:newGold});
      if(newGold>=10000){
        db.collection('globalNotifications').add({
          message: `${d.data().displayName} ganhou ${newGold} gold!`,
          timestamp: firebase.firestore.FieldValue.serverTimestamp()
        });
      }
    });
    updateMyInfo(user.uid);
    workMsg.textContent='+1 gold!';
    setTimeout(()=>workMsg.textContent='',1200);
    reloadRank();
  }catch(err){ console.error(err); alert('Erro: '+err); }
};

// Aposta 50/50
document.getElementById('btnBet').onclick=async ()=>{
  const user = auth.currentUser;
  if(!user){ alert('Fa√ßa login'); return; }
  const amt = Number(document.getElementById('betAmount').value);
  if(!amt || amt<=0){ alert('Insira um valor v√°lido'); return; }
  const userRef = db.collection('users').doc(user.uid);
  const doc = await userRef.get();
  if((doc.data().gold||0)<amt){ alert('Gold insuficiente'); return; }
  const win = Math.random()<0.5;
  const diff = win?amt: -amt;
  await userRef.update({gold:(doc.data().gold||0)+diff});
  updateMyInfo(user.uid);
  betMsg.textContent=win?`Voc√™ ganhou ${amt} gold!`:`Voc√™ perdeu ${amt} gold!`;
  setTimeout(()=>betMsg.textContent='',2000);
  if((doc.data().gold||0)+diff>=10000){
    db.collection('globalNotifications').add({
      message: `${doc.data().displayName} ganhou ${(doc.data().gold||0)+diff} gold!`,
      timestamp: firebase.firestore.FieldValue.serverTimestamp()
    });
  }
  reloadRank();
};

// Aposta Alta (chance menor)
document.getElementById('btnHighBet').onclick=async ()=>{
  const user = auth.currentUser;
  if(!user){ alert('Fa√ßa login'); return; }
  const amt = Number(document.getElementById('highBetAmount').value);
  if(!amt || amt<=0){ alert('Insira um valor v√°lido'); return; }
  const userRef = db.collection('users').doc(user.uid);
  const doc = await userRef.get();
  if((doc.data().gold||0)<amt){ alert('Gold insuficiente'); return; }
  const win = Math.random()<0.2; // chance baixa
  const diff = win?amt*5: -amt;
  await userRef.update({gold:(doc.data().gold||0)+diff});
  updateMyInfo(user.uid);
  document.getElementById('highBetMsg').textContent=win?`Voc√™ ganhou ${amt*5} gold!`:`Voc√™ perdeu ${amt} gold!`;
  setTimeout(()=>document.getElementById('highBetMsg').textContent='',2000);
  if(win && ((doc.data().gold||0)+diff)>=10000){
    db.collection('globalNotifications').add({
      message: `${doc.data().displayName} ganhou ${(doc.data().gold||0)+diff} gold!`,
      timestamp: firebase.firestore.FieldValue.serverTimestamp()
    });
  }
  reloadRank();
};

// =======================
// RANK GLOBAL
// =======================
async function reloadRank(){
  const snap=await db.collection('users').orderBy('gold','desc').limit(50).get();
  let html='<ol>';
  snap.forEach(doc=>{
    const d=doc.data();
    html+=`<li style="margin:.4rem 0"><strong>${escapeHtml(d.displayName||d.email||'user')}</strong> ‚Äî ${Number(d.gold||0)} gold</li>`;
  });
  html+='</ol>';
  rankList.innerHTML=html;
}

// =======================
// CHAT GLOBAL
// =======================
async function loadChat(){
  db.collection('chat').orderBy('timestamp').onSnapshot(snapshot=>{
    chatBox.innerHTML='';
    snapshot.forEach(doc=>{
      const msg = doc.data();
      const el = document.createElement('div');
      el.classList.add('chat-msg');
      el.textContent = `[${new Date(msg.timestamp?.toDate()).toLocaleTimeString()}] ${msg.user}: ${msg.text}`;
      chatBox.appendChild(el);
    });
    chatBox.scrollTop = chatBox.scrollHeight;
  });
}

document.getElementById('btnSendChat').onclick=async ()=>{
  const user = auth.currentUser;
  if(!user){ alert('Fa√ßa login'); return; }
  const text = chatInput.value.trim();
  if(!text) return;
  await db.collection('chat').add({
    user: user.email.split('@')[0],
    text: escapeHtml(text),
    timestamp: firebase.firestore.FieldValue.serverTimestamp()
  });
  chatInput.value='';
};

// =======================
// CONTADOR DE VISITANTES
// =======================
db.collection('visitors').doc('count').get().then(doc=>{
  if(!doc.exists) db.collection('visitors').doc('count').set({total:0});
  db.collection('visitors').doc('count').onSnapshot(doc=>{
    visitorCounter.textContent = doc.data().total || 0;
  });
  db.collection('visitors').doc('count').update({total:firebase.firestore.FieldValue.increment(1)});
});

// =======================
// NOTIFICA√á√ïES GLOBAIS
// =======================
db.collection('globalNotifications').orderBy('timestamp','desc').limit(10).onSnapshot(snapshot=>{
  snapshot.forEach(doc=>{
    const msg = doc.data();
    alert(msg.message); // Simples alert, pode trocar por um popup estilizado
  });
});
</script>
</body>
</html>