<!DOCTYPE html>
<html lang="pt-br">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>IVAD TROCAS E VENDAS - MULTIJOGOS</title>
<style>
/* VARS */
:root{
  --card-bg: rgba(0,0,0,0.85); 
  --btn-gradient: linear-gradient(90deg,#ffd54f,#ffb300);
  --btn-blue: linear-gradient(90deg,#90caf9,#42a5f5);
  --btn-red: linear-gradient(90deg,#ef9a9a,#e57373);
  --text-primary: #fff;
  --text-secondary: #c0c0c0;
  --main-gold: #ffb300;
  --border-color: rgba(255,255,255,0.15);
  --green-win: #4CAF50;
  --red-loss: #E57373;
}

/* BASE & LAYOUT */
html,body{height:100%;margin:0;font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;color:var(--text-primary);background:#000}
body{perspective:1000px;overflow-x:hidden}

.bg3d{
  position:fixed;inset:0;background:url('/* LINK RAW IMAGEM */') no-repeat center center;
  background-size:cover;z-index:-2;filter:contrast(0.92) saturate(0.95) brightness(0.9);
  transform-origin:center center;animation:float3d 18s ease-in-out infinite alternate;
}
@keyframes float3d{
  0%{transform:translateZ(0px) rotateY(0deg) rotateX(0deg) scale(1)}
  50%{transform:translateZ(12px) rotateY(2deg) rotateX(1deg) scale(1.01)}
  100%{transform:translateZ(0px) rotateY(-1deg) rotateX(-1deg) scale(1)}
}
.overlay{position:fixed;inset:0;z-index:-1;background:linear-gradient(135deg, rgba(0,0,0,0.8), rgba(0,0,0,0.6))}

header{background:rgba(0,0,0,0.9);padding:1.4rem;text-align:center;position:relative;z-index:2;border-bottom: 3px solid var(--main-gold); box-shadow: 0 4px 15px rgba(0,0,0,0.7);}
header h1{margin:.2rem;font-size:2rem; letter-spacing: 3px; text-shadow: 0 0 10px rgba(255,179,0,0.8);}
header p{margin:.1rem;color:var(--text-secondary);font-size:0.95rem}

.container{max-width:1100px;margin:2rem auto;padding:1rem;display:grid;grid-template-columns:300px 1fr;gap:2rem}
.card{background:var(--card-bg);padding:1.5rem;border-radius:12px;box-shadow:0 12px 40px rgba(0,0,0,0.9);border: 1px solid var(--border-color);}

/* MENU E ABAS */
.menu button{display:block;width:100%;margin-bottom:.8rem;padding:.9rem 1rem;border-radius:8px;border:none;background:rgba(255,255,255,0.1);color:var(--text-primary);font-weight:700;cursor:pointer;transition:all .2s}
.menu button:hover{transform:translateY(-2px);box-shadow:0 6px 15px rgba(255,179,0,0.4); background:rgba(255,255,255,0.15);}
.menu button.active{background:var(--btn-gradient);color:#111;transform:translateY(0);box-shadow:0 4px 10px rgba(0,0,0,0.5)}

/* CONTE√öDO */
.content h2{margin-top:0; border-bottom: 2px solid var(--border-color); padding-bottom: 10px; margin-bottom: 1.5rem; color: var(--main-gold);}
ul{padding-left:1.5rem}
.small{font-size:.85rem;color:var(--text-secondary)}

/* BOT√ïES GERAIS */
.btn{
  display:inline-block;padding:.8rem 1.5rem;border-radius:8px;border:none;background:var(--btn-gradient);color:#111;font-weight:700;cursor:pointer; 
  transition: all .2s; position: relative; overflow: hidden; transform: translateZ(0);
}
.btn:hover:not(:disabled){box-shadow: 0 0 20px rgba(255,179,0,0.5); transform: scale(1.02);}
.btn:disabled{opacity:0.6; cursor: not-allowed; filter: grayscale(100%);}
.btn::before { /* Efeito Shine */
    content: ''; position: absolute; top: 0; left: -75%; width: 50%; height: 100%;
    background: linear-gradient(to right, rgba(255,255,255,0) 0%, rgba(255,255,255,0.4) 100%);
    transform: skewX(-25deg); transition: all 0.7s;
}
.btn:not(:disabled):hover::before { left: 125%; }

/* INPUTS */
input[type="text"],input[type="password"],input[type=number],select,textarea{width:100%;padding:.9rem;margin:.5rem 0;border-radius:8px;border:1px solid rgba(255,255,255,0.3);background:rgba(0,0,0,0.5);color:var(--text-primary);box-sizing: border-box; transition: border-color .2s;}
input:focus, textarea:focus{outline: none; border-color: var(--main-gold);}

/* RANKING */
.rank-list{max-height:420px;overflow-y:auto;padding:1rem; background: rgba(0,0,0,0.4);}
.rank-list ol{padding-left: 0; margin: 0;}
.rank-list li{list-style: none; padding: .6rem 0; border-bottom: 1px dashed rgba(255,255,255,0.1); display: flex; justify-content: space-between; align-items: center;}
.rank-list li strong{color: #fff;}
.rank-list li:nth-child(1) strong{color: var(--main-gold); text-shadow: 0 0 5px var(--main-gold);}
.rank-list li:nth-child(2) strong{color: #c0c0c0;}
.rank-list li:nth-child(3) strong{color: #cd7f32;}

/* CHAT */
.chat-box{max-height:300px;overflow-y:auto;background:rgba(0,0,0,0.5);padding:.75rem;margin-top:.75rem;border-radius:8px;border: 1px solid var(--border-color)}
.chat-msg{margin:.4rem 0; font-size: 0.9rem; word-wrap: break-word; color: #eee;}
.chat-msg strong{color: #42a5f5; margin-right: 5px; font-weight: 600;}
.chat-msg .audio-player{display: block; margin-top: 5px; width: 100%;}
.chat-input-area{margin-top:.75rem; display: flex; gap: 5px; flex-wrap: wrap; align-items: stretch;}
.chat-input-area input[type=text]{margin: 0; flex-grow: 1;}
.chat-input-area button{padding: 0 1.2rem; margin: 0; font-size: 1rem;}
#btnRecordAudio{background: var(--btn-blue); color: #fff; width: 50px; font-size: 1.2rem;}
#btnRecordAudio.recording{background: var(--btn-red); animation: pulse 1s infinite;}
@keyframes pulse { 0% { box-shadow: 0 0 0 0 rgba(229, 115, 115, 0.7); } 70% { box-shadow: 0 0 0 10px rgba(229, 115, 115, 0); } 100% { box-shadow: 0 0 0 0 rgba(229, 115, 115, 0); } }

/* JOGOS DE HABILIDADE */
.game-area{
    display: flex; flex-direction: column; gap: 15px;
}
.quiz-options button {
    display: block; width: 100%; margin-bottom: 5px; padding: 10px; border-radius: 6px;
    background: rgba(255,255,255,0.1); color: var(--text-primary); border: 1px solid var(--border-color);
    cursor: pointer; transition: background .2s;
}
.quiz-options button:hover:not(:disabled) { background: rgba(255,255,255,0.2); }
.quiz-options button.correct { background: var(--green-win); color: #000; }
.quiz-options button.incorrect { background: var(--red-loss); }

/* Jogo da Velha (Apenas placeholder visual) */
.tictactoe-grid {
    display: grid; grid-template-columns: repeat(3, 1fr); gap: 5px; max-width: 300px; margin: 10px auto;
}
.tictactoe-cell {
    width: 100px; height: 100px; background: rgba(255,255,255,0.1); display: flex;
    justify-content: center; align-items: center; font-size: 3rem; font-weight: bold;
    cursor: pointer; user-select: none; transition: background .2s; border-radius: 8px;
}
.tictactoe-cell:hover:not(.x):not(.o) { background: rgba(255,255,255,0.2); }
.tictactoe-cell.x { color: var(--btn-blue); }
.tictactoe-cell.o { color: var(--btn-red); }

/* Apostas Avan√ßadas (Apenas placeholder visual) */
.bet-options { display: flex; gap: 20px; flex-wrap: wrap;}
.bet-option-card {
    flex: 1 1 30%; background: rgba(255,255,255,0.05); padding: 1rem; border-radius: 10px;
    border: 1px solid var(--border-color); min-width: 180px;
}
/* Raspadinha */
.scratch-area { 
    width: 100%; height: 50px; background: #c0c0c0; border: 2px solid #fff; border-radius: 8px;
    display: flex; justify-content: center; align-items: center; font-size: 1.5rem;
    font-weight: bold; color: #333; cursor: pointer; user-select: none; margin-top: 10px;
    box-shadow: 0 0 10px rgba(0,0,0,0.5) inset;
}
.scratched { background: #333; color: var(--main-gold); }

/* Roleta */
.prize-wheel {
    width: 100%; max-width: 250px; aspect-ratio: 1/1; border-radius: 50%;
    margin: 10px auto; background: conic-gradient(red 0 33%, blue 33% 66%, green 66% 100%);
    position: relative; transition: transform 4s cubic-bezier(0.25, 0.1, 0.25, 1);
    border: 5px solid var(--main-gold);
}
.wheel-pointer {
    position: absolute; top: -10px; left: 50%; transform: translateX(-50%);
    width: 0; height: 0; border-left: 10px solid transparent; border-right: 10px solid transparent;
    border-bottom: 15px solid var(--main-gold); z-index: 10;
}
/* SOCIAL / ID */
.user-id-box { 
    background: rgba(255,255,255,0.1); padding: 10px; border-radius: 8px; margin-bottom: 15px;
    text-align: center; border: 1px solid var(--main-gold);
}
.friend-list { max-height: 200px; overflow-y: auto; padding: 10px; background: rgba(0,0,0,0.3); border-radius: 6px;}
.friend-list li { list-style: none; padding: 8px 0; border-bottom: 1px dashed rgba(255,255,255,0.1); display: flex; justify-content: space-between; align-items: center;}


/* NOTIFICA√á√ÉO GLOBAL */
#globalNotice{
    position:fixed;top:10px;right:10px;background:var(--main-gold);color:#111;padding:.9rem 1.8rem;border-radius:8px;display:none;z-index:9999;
    font-weight:700;box-shadow:0 4px 15px rgba(0,0,0,0.7);
    animation: fadeInOut 4.5s cubic-bezier(0.19, 1, 0.22, 1) forwards;
}
@keyframes fadeInOut { 0%{opacity:0; transform: translateX(100px)} 5%{opacity:1; transform: translateX(0)} 95%{opacity:1; transform: translateX(0)} 100%{opacity:0; transform: translateX(100px)} }

@media(max-width:880px){ .container{grid-template-columns:1fr; padding:.5rem; margin-top: 1rem} .menu{order:2} .bet-option-card { flex-basis: 100%;} }
</style>
</head>
<body>
<div class="bg3d" aria-hidden="true"></div>
<div class="overlay" aria-hidden="true"></div>

<header>
  <h1>IVAD TROCAS E VENDAS</h1>
  <p>Criado por IVADCREATOR</p>
</header>

<main class="container">
  <aside class="card menu">
    <button class="tabbtn active" data-tab="regrasTab">REGRAS</button>
    <button class="tabbtn" data-tab="socialTab">ü§ù SOCIAL (ID e Amigos)</button>
    <button class="tabbtn" data-tab="jogoSimplesTab">üí∞ GOLD SIMPLES (Trabalho/Apostas)</button>
    <button class="tabbtn" data-tab="apostasAvancadasTab">üé≤ APOSTAS AVAN√áADAS</button>
    <button class="tabbtn" data-tab="habilidadeTab">üß† JOGOS DE HABILIDADE</button>
    <button class="tabbtn" data-tab="salesTab">üí≤ VENDAS (Dinheiro Real)</button>
    <button class="tabbtn" data-tab="rankTab">üèÜ RANK GLOBAL</button>
    <button class="tabbtn" data-tab="chatTab">üí¨ CHAT GLOBAL</button>
    <hr style="border:none;height:1px;background:var(--border-color);margin:15px 0">

    <div id="authArea" class="small">
      <div id="signedOutUI">
        <input id="username" type="text" placeholder="Escolha um nome (sem espa√ßos)">
        <input id="pwd" type="password" placeholder="Senha (‚â•6)">
        <div style="display:flex;gap:.5rem">
          <button id="btnSignup" class="btn" style="background:var(--btn-blue); flex-grow: 1;">Criar conta</button>
          <button id="btnLogin" class="btn" style="flex-grow: 1;">Entrar</button>
        </div>
        <p class="small" style="margin-top: 5px;">Nome √∫nico (A-z, 0-9, _).</p>
      </div>

      <div id="signedInUI" style="display:none">
        <p style="margin-bottom: .8rem;"><strong id="userLabel"></strong></p>
        <div style="display:flex;gap:.5rem;align-items:center">
          <button id="btnLogout" class="btn" style="background:var(--btn-red); padding: .6rem 1rem;">Sair</button>
          <div style="margin-left:auto; font-size: 1.2rem;"><span class="small" style="color:var(--main-gold);">Gold: </span><strong id="myGold">0</strong></div>
        </div>
      </div>
    </div>

    <hr style="border:none;height:1px;background:var(--border-color);margin:15px 0">
    <div id="ownerPanel" style="display:none">
      <h4 style="margin:.3rem 0; color: #e57373;">Painel do Dono</h4>
      <input id="adminName" placeholder="nome do usu√°rio (exact)">
      <input id="adminAmount" type="number" placeholder="gold (+/-)">
      <button id="btnGive" class="btn" style="width: 100%; margin-top: .5rem; background: var(--btn-blue);">Dar/Remover gold</button>
      <button id="btnReset" class="btn" style="background:var(--btn-red);margin-top:.5rem; width: 100%;">Resetar ranking</button>
      <button id="btnClearChat" class="btn" style="background:var(--btn-red);margin-top:.5rem; width: 100%;">Limpar Chat Global</button>
      <p class="small" style="margin-top: 5px;">Somente OWNER_UID pode usar</p>
    </div>
    <hr style="border:none;height:1px;background:var(--border-color);margin:15px 0">
    <p class="small">Ranking salvo no Firestore.</p>
    <p class="small">Visitantes online: <strong id="visitorCount">0</strong></p>
  </aside>

  <section class="card content">
    <div id="regrasTab">
      <h2>Regras</h2>
      <h3>üö´ Proibido</h3>
      <ul>
        <li>**Spam** ou flood de mensagens repetitivas.</li>
        <li>Compartilhar **conte√∫do NSFW** (banimento imediato se detectado!).</li>
        <li>**Avaliar contas** de outros membros.</li>
        <li>Ofensas, xingamentos ou **desrespeito** m√∫tuo.</li>
        <li>Vendas de itens ilegais ou roubados.</li>
      </ul>
      <h3>‚úÖ Permitido</h3>
      <ul>
        <li>Anunciar itens por dinheiro real na aba de Vendas.</li>
        <li>Comprar e vender produtos de forma **clara e transparente**.</li>
        <li>Negociar e interagir com **bom senso** e educa√ß√£o.</li>
      </ul>
      <h3>‚ö†Ô∏è Observa√ß√µes</h3>
      <ul>
        <li>Descumprimento pode levar a **banimento**.</li>
        <li>Negocia√ß√µes s√£o **responsabilidade das partes**.</li>
        <li>O Chat √© monitorado para garantir um ambiente saud√°vel.</li>
      </ul>
    </div>

    <div id="socialTab" style="display:none">
      <h2>ü§ù Social: Amigos e ID</h2>
      <div id="playerInfoSocial" class="user-id-box" style="display:none;">
          <p style="margin: 0;"><span class="small" style="color:var(--main-gold);">Seu Nome: </span><strong id="socialUsername"></strong></p>
          <p style="margin: 5px 0 0 0;"><span class="small" style="color:var(--main-gold);">Seu ID √önico: </span><strong id="socialUserId"></strong></p>
          <p class="small" style="margin-top: 10px;">Use este ID para ser adicionado ou convidado para jogos.</p>
      </div>

      <h3 style="margin-top: 1.5rem;">Adicionar Amigo</h3>
      <input type="text" id="friendInput" placeholder="ID √önico ou Nome do Usu√°rio">
      <button id="btnAddFriend" class="btn" style="width: 100%; background: var(--btn-blue);">Adicionar</button>
      <span id="friendMsg" class="small" style="display: block; margin-top: 5px;"></span>

      <h3 style="margin-top: 2rem;">Minha Lista de Amigos (<span id="friendCount">0</span>)</h3>
      <ul class="friend-list" id="friendList">
        <p class="small" style="text-align: center;">Adicione amigos por ID para que eles apare√ßam aqui.</p>
      </ul>
    </div>

    <div id="jogoSimplesTab" style="display:none">
        <h2>üí∞ Gold Simples (Trabalho e Apostas)</h2>
      
      <div id="playerInfo" class="card" style="margin-bottom:1.5rem; padding: .8rem; background: rgba(255,255,255,0.15); display:none;">
        <p style="margin: 0;">Seu Gold: <strong id="playerGold" style="color: var(--main-gold);">0</strong></p>
      </div>

      <p class="small">Clique **Trabalhar**. Ganho varia de **1% a 100%** do seu Gold atual. (Cooldown: 5s)</p>
      <button id="btnWork" class="btn" onclick="work()">Trabalhar (Gold Aleat√≥rio)</button>
      <span id="workMsg" class="small" style="margin-left:1rem; color: #90caf9;"></span>

      <hr style="border:none;height:1px;background:var(--border-color);margin:20px 0">

      <h3 style="margin-top: 1rem;">Aposta Simples (2x)</h3>
      <p class="small">Chance de 50%. Ganha 2x o que apostou se acertar, **perde o valor se errar**.</p>
      <input type="number" id="betAmount" placeholder="Quantos golds apostar?" min="1">
      <button id="btnBetSimple" class="btn">Apostar 2x</button>
      <span id="betMsgSimple" class="small" style="color: #ffd54f;"></span>

      <h3 style="margin-top: 2rem;">Aposta M√©dia (5x)</h3>
      <p class="small">Chance de 20%. Ganha 5x o que apostou, **perde o valor se errar**.</p>
      <input type="number" id="betAmountMedium" placeholder="Quantos golds apostar?" min="1">
      <button id="btnBetMedium" class="btn" style="background:var(--btn-blue)">Apostar 5x</button>
      <span id="betMsgMedium" class="small" style="color: #90caf9;"></span>

      <h3 style="margin-top: 2rem;">Aposta Alta (10x)</h3>
      <p class="small">Chance de 10%. Ganha 10x o que apostou, **perde o valor se errar**.</p>
      <input type="number" id="betAmountHigh" placeholder="Quantos golds apostar?" min="1">
      <button id="btnBetHigh" class="btn" style="background:var(--btn-red)">Apostar 10x</button>
      <span id="betMsgHigh" class="small" style="color: #ef9a9a;"></span>
    </div>

    <div id="apostasAvancadasTab" style="display:none">
        <h2>üé≤ Apostas Avan√ßadas</h2>

        <p class="small">Aqui voc√™ encontra jogos de sorte com chances fixas e pr√™mios variados.</p>

        <div class="bet-options">
            <div class="bet-option-card">
                <h3 style="margin-top: 0;">Cor (2x ou 4x)</h3>
                <p class="small">Aposte no Vermelho (48%), Preto (48%) ou Verde (4%).</p>
                <input type="number" id="betCorAmount" placeholder="Gold para apostar" min="1">
                <select id="betCorColor" style="margin-bottom: 10px;">
                    <option value="red" style="color: red;">Vermelho (2x)</option>
                    <option value="black" style="color: #333;">Preto (2x)</option>
                    <option value="green" style="color: green;">Verde (4x)</option>
                </select>
                <button id="btnBetCor" class="btn" style="width: 100%;">Apostar</button>
                <span id="betCorMsg" class="small" style="display: block; margin-top: 5px;"></span>
            </div>

            <div class="bet-option-card">
                <h3 style="margin-top: 0;">Raspadinha R$50</h3>
                <p class="small">Custa 50 Gold. Ganhe 0x, 2x, 5x, ou 10x o valor da aposta (50 Gold).</p>
                <div id="scratchCard" class="scratch-area">RASPE AQUI!</div>
                <button id="btnScratch" class="btn" style="width: 100%; margin-top: 10px;">Comprar Raspadinha (50 Gold)</button>
                <span id="scratchMsg" class="small" style="display: block; margin-top: 5px;"></span>
            </div>

            <div class="bet-option-card">
                <h3 style="margin-top: 0;">Roleta de Pr√™mios</h3>
                <p class="small">Custa 100 Gold. Gire e ganhe **+500**, **+100** ou **-200** Gold.</p>
                <div style="position: relative; text-align: center;">
                    <div class="wheel-pointer"></div>
                    <div id="prizeWheel" class="prize-wheel"></div>
                </div>
                <button id="btnSpin" class="btn" style="width: 100%;">Girar Roleta (100 Gold)</button>
                <span id="spinMsg" class="small" style="display: block; margin-top: 5px;"></span>
            </div>
        </div>
    </div>

    <div id="habilidadeTab" style="display:none">
        <h2>üß† Jogos de Habilidade e Torneios</h2>
        <p class="small">Teste sua intelig√™ncia e reflexos. Alguns jogos permitem apostas contra amigos.</p>
        
        <div class="game-area">
            <div class="card" style="background: rgba(0,0,0,0.4); padding: 1rem;">
                <h4>Quiz R√°pido: Qual o Gold do Campe√£o?</h4>
                <p class="small">Aposte 10 Gold. Acerte a pergunta em 5s e ganhe 50 Gold. Erre ou estoure o tempo e perca.</p>
                <p id="quizQuestion">Clique em "Come√ßar" para iniciar.</p>
                <div id="quizOptions" class="quiz-options"></div>
                <button id="btnStartQuiz" class="btn" style="background: var(--btn-blue);">Come√ßar Quiz (Aposta: 10 Gold)</button>
                <span id="quizMsg" class="small" style="display: block; margin-top: 5px;"></span>
            </div>

            <div class="card" style="background: rgba(0,0,0,0.4); padding: 1rem;">
                <h4>Mini Torneio: Jogo da Velha (PvP)</h4>
                <p class="small">Convide um amigo por ID √önico para jogar. O vencedor leva o Gold.</p>
                
                <div id="tictactoeLobby">
                    <input type="text" id="tttFriendId" placeholder="ID √önico do Amigo para Convidar">
                    <input type="number" id="tttBetAmount" placeholder="Gold para apostar (min 100)" min="100">
                    <button id="btnInviteTTT" class="btn" style="width: 100%;">Convidar para Jogo</button>
                    <span id="tttMsg" class="small" style="display: block; margin-top: 5px;"></span>
                </div>
                
                <div id="tictactoeGame" style="display:none;">
                    <p id="tttStatus" style="font-weight: bold;"></p>
                    <div class="tictactoe-grid">
                        <div class="tictactoe-cell" data-index="0"></div>
                        <div class="tictactoe-cell" data-index="1"></div>
                        <div class="tictactoe-cell" data-index="2"></div>
                        <div class="tictactoe-cell" data-index="3"></div>
                        <div class="tictactoe-cell" data-index="4"></div>
                        <div class="tictactoe-cell" data-index="5"></div>
                        <div class="tictactoe-cell" data-index="6"></div>
                        <div class="tictactoe-cell" data-index="7"></div>
                        <div class="tictactoe-cell" data-index="8"></div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div id="salesTab" style="display:none">
        <h2>üí≤ Vendas e Compras (Dinheiro Real)</h2>
        <p class="small">Use este espa√ßo para negociar itens com dinheiro real (R$). A IVAD n√£o se responsabiliza pelas transa√ß√µes, mas monitora o uso indevido.</p>
        
        <h3 style="margin-top: 1.5rem;">Criar An√∫ncio</h3>
        <input type="text" placeholder="Item que deseja vender/trocar">
        <input type="number" placeholder="Pre√ßo em R$">
        <textarea placeholder="Descri√ß√£o e forma de pagamento"></textarea>
        <button class="btn" style="width: 100%;">Publicar An√∫ncio</button>
    </div>

    <div id="rankTab" style="display:none">
        <h2>üèÜ Rank Global (Top 10)</h2>
        <p class="small">Atualiza a cada 5 segundos para refletir a competi√ß√£o em tempo real.</p>
        <div class="rank-list">
            <ol>
                <li>Carregando...</li>
            </ol>
        </div>
    </div>

    <div id="chatTab" style="display:none">
        <h2>üí¨ Chat Global (Tempo Real)</h2>
        <p class="small">As mensagens aparecem **instantaneamente** para todos os usu√°rios logados. Proibido spam ou conte√∫do NSFW.</p>
        
        <div class="chat-box" id="chatMessages">
            Aguardando conex√£o com o chat...
        </div>

        <div class="chat-input-area">
            <input type="text" id="chat-message-input" placeholder="Digite sua mensagem..." />
            <button onclick="sendMessage()" class="btn" style="background:var(--btn-gradient)">Enviar</button>
            <button id="btnRecordAudio" class="btn" style="background:var(--btn-blue)">üé§ Gravar √Åudio</button>
        </div>
        <span id="audioStatusMsg" class="small" style="display:block; margin-top: 5px;">Clique no microfone para gravar uma mensagem de 60s.</span>
    </div>

  </section>
</main>

<div id="globalNotice"></div>

<script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-auth-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-firestore-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-storage-compat.js"></script>

<script>
    // ----------------------------------------------------
    // 1. CONFIGURA√á√ÉO DO FIREBASE (CR√çTICO)
    // ----------------------------------------------------
    const firebaseConfig = {
        // Sua chave API confirmada
        apiKey: "AIzaSyCkmyMqEJaM8jVvmTN8I3gLnbC8YtMPWOI", 
        
        // Baseado no seu Project ID (regras-ivad)
        authDomain: "regras-ivad.firebaseapp.com", 
        
        // Seu Project ID
        projectId: "regras-ivad", 
        
        // Seu Storage Bucket
        storageBucket: "regras-ivad.firebasestorage.app", 
        
        // Seu Project Number
        messagingSenderId: "812565896201", 
        
        // **ATEN√á√ÉO: App ID SIMULADO. Substitua se o seu for diferente**
        appId: "1:812565896201:web:d82f7e02e861d9a2a3b05a" 
    };

    // Inicializa o Firebase
    const app = firebase.initializeApp(firebaseConfig);
    const db = app.firestore();
    const auth = app.auth();
    const storage = app.storage();
    const serverTimestamp = firebase.firestore.FieldValue.serverTimestamp;

    // ** SUBSTITUA PELO SEU UID DE ADMIN REAL **
    const OWNER_UID = 'm3h06woQv2V7lrNu1p8fDQCZ8IW2'; 

    // Vari√°veis globais para √°udio e controle
    let mediaRecorder;
    let audioChunks = [];
    let isRecording = false;

    // ----------------------------------------------------
    // 2. L√ìGICA DE INTERFACE E TABS
    // ----------------------------------------------------
    document.querySelectorAll('.tabbtn').forEach(button => {
        button.addEventListener('click', function() {
            document.querySelectorAll('.tabbtn').forEach(btn => btn.classList.remove('active'));
            this.classList.add('active');
            
            document.querySelectorAll('.content > div').forEach(div => div.style.display = 'none');
            document.getElementById(this.dataset.tab).style.display = 'block';

            // Chamadas espec√≠ficas para recarregar conte√∫do em tempo real
            if (this.dataset.tab === 'rankTab') loadRank(true); 
            if (this.dataset.tab === 'chatTab') loadChat();
        });
    });

    // ----------------------------------------------------
    // 3. L√ìGICA DE AUTENTICA√á√ÉO E PERFIL
    // ----------------------------------------------------

    auth.onAuthStateChanged(user => {
        if (user) {
            document.getElementById('signedOutUI').style.display = 'none';
            document.getElementById('signedInUI').style.display = 'block';
            document.getElementById('userLabel').textContent = `Bem-vindo, ${user.displayName || 'An√¥nimo'}!`;
            document.getElementById('playerInfo').style.display = 'block';
            document.getElementById('playerInfoSocial').style.display = 'block';
            document.getElementById('socialUsername').textContent = user.displayName || 'An√¥nimo';
            document.getElementById('socialUserId').textContent = user.uid;

            // Painel do Dono
            if (user.uid === m3h06woQv2V7lrNu1p8fDQCZ8IW2) {
                document.getElementById('ownerPanel').style.display = 'block';
            } else {
                document.getElementById('ownerPanel').style.display = 'none';
            }
            
            // Monitora o Gold do usu√°rio em tempo real
            db.collection("users").doc(user.uid).onSnapshot(doc => {
                const data = doc.data();
                const gold = data ? (data.gold || 0).toLocaleString('pt-BR') : 0;
                document.getElementById('myGold').textContent = gold;
                document.getElementById('playerGold').textContent = gold;
            });
            
            // Inicia o rastreamento de visitantes e o chat
            trackVisitor();
            loadChat(); 

        } else {
            // UI Deslogada
            document.getElementById('signedOutUI').style.display = 'block';
            document.getElementById('signedInUI').style.display = 'none';
            document.getElementById('playerInfo').style.display = 'none';
            document.getElementById('playerInfoSocial').style.display = 'none';

            // Tenta login an√¥nimo para permitir a leitura do Rank e Chat
            auth.signInAnonymously().catch(error => console.error("Erro ao logar anonimamente:", error));
        }
    });

    // Fun√ß√µes de Login, Cadastro e Logout
    document.getElementById('btnLogout').addEventListener('click', () => auth.signOut());
    
    document.getElementById('btnSignup').addEventListener('click', () => {
        const email = document.getElementById('username').value + '@ivad.temp';
        const password = document.getElementById('pwd').value;
        const name = document.getElementById('username').value;
        
        if (!name || password.length < 6) return alert("Nome e senha (m√≠n. 6 caracteres) s√£o obrigat√≥rios.");

        auth.createUserWithEmailAndPassword(email, password)
            .then(cred => {
                return cred.user.updateProfile({ displayName: name }).then(() => {
                    return db.collection('users').doc(cred.user.uid).set({
                        name: name,
                        displayName: name,
                        gold: 100, // Gold inicial
                        createdAt: serverTimestamp()
                    });
                });
            })
            .then(() => showGlobalNotice("Conta criada com sucesso! 100 Gold de b√¥nus.", 'var(--green-win)'))
            .catch(error => alert("Erro ao criar conta: " + error.message.replace('auth/', '')));
    });

    document.getElementById('btnLogin').addEventListener('click', () => {
        const email = document.getElementById('username').value + '@ivad.temp';
        const password = document.getElementById('pwd').value;
        auth.signInWithEmailAndPassword(email, password)
            .catch(error => alert("Erro no login: " + error.message.replace('auth/', '')));
    });


    // ----------------------------------------------------
    // 4. L√ìGICA DO RANK GLOBAL (COMPETITIVO EM TEMPO REAL)
    // ----------------------------------------------------

    window.loadRank = function(force = false) {
        const rankList = document.querySelector('.rank-list ol') || document.createElement('ol');
        if (!document.querySelector('.rank-list ol')) {
            const container = document.querySelector('.rank-list');
            if(container) {
                container.innerHTML = '';
                container.appendChild(rankList);
            }
        }

        db.collection("users")
            .orderBy("gold", "desc")
            .limit(10)
            .get()
            .then(snapshot => {
                let html = '';
                let position = 1;
                snapshot.forEach(doc => {
                    const data = doc.data();
                    const userName = data.displayName || data.name || `Usu√°rio #${doc.id.substring(0, 4)}`;
                    const gold = data.gold ? data.gold.toLocaleString('pt-BR') : 0;
                    const isCurrentUser = auth.currentUser && doc.id === auth.currentUser.uid;
                    const style = isCurrentUser ? 'style="border: 2px solid var(--main-gold); background: rgba(255,179,0,0.1); border-radius: 4px;"' : '';

                    html += `
                        <li ${style}>
                            <span>${position}. <strong>${userName}</strong></span> 
                            <span>${gold} Gold</span>
                        </li>
                    `;
                    position++;
                });
                rankList.innerHTML = html;
            })
            .catch(error => {
                rankList.innerHTML = '<li>Erro ao carregar o rank. Verifique as Regras.</li>';
                console.error("Erro ao carregar o rank: ", error);
            });
    }
    
    // Atualiza o rank a cada 5 segundos
    setInterval(loadRank, 5000); 
    loadRank(); 


    // ----------------------------------------------------
    // 5. L√ìGICA DO CHAT GLOBAL (TEMPO REAL E √ÅUDIO)
    // ----------------------------------------------------

    window.loadChat = function() {
        const chatMessagesDiv = document.getElementById('chatMessages');

        db.collection("chat")
            .orderBy("timestamp", "asc")
            .limitToLast(50) 
            .onSnapshot(snapshot => {
                chatMessagesDiv.innerHTML = ''; 
                snapshot.forEach(doc => {
                    const data = doc.data();
                    const userName = data.userName || "An√¥nimo";
                    const timestamp = data.timestamp ? new Date(data.timestamp.toDate()).toLocaleTimeString() : 'agora';
                    const isCurrentUser = auth.currentUser && data.userId === auth.currentUser.uid;
                    const nameColor = isCurrentUser ? 'var(--main-gold)' : '#42a5f5';
                    
                    let content = '';
                    if (data.message) {
                        content = data.message;
                    } else if (data.audioURL) {
                        content = `
                            üîà √Åudio: 
                            <audio controls class="audio-player" src="${data.audioURL}"></audio>
                        `;
                    }

                    const msgElement = document.createElement('div');
                    msgElement.classList.add('chat-msg');
                    msgElement.innerHTML = `<strong style="color:${nameColor}">[${timestamp}] ${userName}:</strong> ${content}`;
                    chatMessagesDiv.appendChild(msgElement);
                });
                chatMessagesDiv.scrollTop = chatMessagesDiv.scrollHeight;
            }, error => {
                console.error("Erro ao carregar o chat em tempo real:", error);
                chatMessagesDiv.innerHTML = 'Ocorreu um erro ao carregar as mensagens. Verifique as Regras do Firestore.';
            });
    }
    
    // Envia mensagem de TEXTO
    window.sendMessage = function() {
        const user = auth.currentUser;
        const input = document.getElementById('chat-message-input');
        const messageText = input.value.trim();

        if (!user || user.isAnonymous) {
            return showGlobalNotice("Fa√ßa login (n√£o an√¥nimo) para enviar mensagens.", 'var(--btn-red)');
        }

        if (messageText === "") return;

        db.collection("chat").add({
            userId: user.uid,
            userName: user.displayName || `Competidor-${user.uid.substring(0, 4)}`,
            message: messageText,
            timestamp: serverTimestamp()
        })
        .then(() => input.value = '')
        .catch(error => {
            showGlobalNotice("Erro ao enviar mensagem. Regras de Seguran√ßa?", 'var(--btn-red)');
            console.error("Erro ao enviar mensagem:", error);
        });
    }
    
    // Configura√ß√£o do bot√£o de grava√ß√£o de √°udio
    const btnRecordAudio = document.getElementById('btnRecordAudio');
    if(btnRecordAudio) {
        btnRecordAudio.addEventListener('click', () => {
            if (isRecording) {
                stopRecording();
            } else {
                startRecording();
            }
        });
    }

    // --- L√≥gica de Grava√ß√£o de √Åudio ---
    window.startRecording = function() {
        if (!auth.currentUser || auth.currentUser.isAnonymous) {
            return showGlobalNotice("Fa√ßa login (n√£o an√¥nimo) para gravar √°udio.", 'var(--btn-red)');
        }

        navigator.mediaDevices.getUserMedia({ audio: true })
            .then(stream => {
                mediaRecorder = new MediaRecorder(stream);
                audioChunks = [];
                mediaRecorder.start();
                isRecording = true;

                mediaRecorder.ondataavailable = event => audioChunks.push(event.data);

                btnRecordAudio.classList.add('recording');
                btnRecordAudio.textContent = 'üõë Parar';
                document.getElementById('chat-message-input').disabled = true;
                document.getElementById('audioStatusMsg').textContent = 'üî¥ Gravando... M√°x 60s';

                setTimeout(() => {
                    if (isRecording) stopRecording();
                }, 60000); 
            })
            .catch(error => {
                showGlobalNotice('Erro: Microfone n√£o encontrado ou permiss√£o negada.', 'var(--btn-red)');
            });
    }

    window.stopRecording = function() {
        if (!mediaRecorder || !isRecording) return;

        mediaRecorder.stop();
        isRecording = false;

        btnRecordAudio.classList.remove('recording');
        btnRecordAudio.textContent = 'Aguarde...';
        btnRecordAudio.disabled = true;
        document.getElementById('audioStatusMsg').textContent = 'Processando √°udio...';

        mediaRecorder.onstop = () => {
            const audioBlob = new Blob(audioChunks, { type: 'audio/webm' });
            uploadAudio(audioBlob);

            mediaRecorder.stream.getTracks().forEach(track => track.stop());
        };
    }

    function uploadAudio(audioBlob) {
        const user = auth.currentUser;
        const fileName = `${user.uid}/${Date.now()}.webm`;
        const storageRef = storage.ref().child('chat_audios/' + fileName);

        storageRef.put(audioBlob)
            .then(snapshot => snapshot.ref.getDownloadURL())
            .then(audioURL => {
                return db.collection("chat").add({
                    userId: user.uid,
                    userName: user.displayName || `Competidor-${user.uid.substring(0, 4)}`,
                    audioURL: audioURL,
                    timestamp: serverTimestamp()
                });
            })
            .then(() => {
                btnRecordAudio.textContent = 'üé§ Gravar √Åudio';
                btnRecordAudio.disabled = false;
                document.getElementById('chat-message-input').disabled = false;
                document.getElementById('audioStatusMsg').textContent = 'Clique no microfone para gravar uma mensagem de 60s.';
                showGlobalNotice("√Åudio enviado com sucesso!", 'var(--green-win)');
            })
            .catch(error => {
                btnRecordAudio.textContent = 'Erro! Tente Novamente';
                btnRecordAudio.disabled = false;
                document.getElementById('chat-message-input').disabled = false;
                document.getElementById('audioStatusMsg').textContent = 'Clique no microfone para gravar uma mensagem de 60s.';
                showGlobalNotice("Erro ao enviar √°udio. Regras de Storage?", 'var(--btn-red)');
                console.error("Erro ao fazer upload ou enviar √°udio:", error);
            });
    }


    // ----------------------------------------------------
    // 6. L√ìGICA DE JOGOS E ADMIN
    // ----------------------------------------------------

    // Trabalhar (Exemplo de Transa√ß√£o Segura)
    window.work = function() {
        const user = auth.currentUser;
        if (!user || user.isAnonymous) return showGlobalNotice("Fa√ßa login para trabalhar.", 'var(--btn-red)');
        
        const btnWork = document.getElementById('btnWork');
        btnWork.disabled = true;
        
        db.runTransaction(transaction => {
            const userRef = db.collection('users').doc(user.uid);
            return transaction.get(userRef).then(doc => {
                const currentGold = doc.data().gold || 0;
                const earned = Math.floor(currentGold * (Math.random() * 0.99 + 0.01));
                const newGold = currentGold + earned;

                transaction.update(userRef, { gold: newGold });
                document.getElementById('workMsg').textContent = `üí∞ Voc√™ ganhou ${earned.toLocaleString('pt-BR')} Gold! Total: ${newGold.toLocaleString('pt-BR')}`;
                
                // Retorna um valor para uso no .then
                return newGold;
            });
        }).then((newGold) => {
            showGlobalNotice(`Voc√™ trabalhou e ganhou Gold!`, 'var(--main-gold)');
            setTimeout(() => btnWork.disabled = false, 5000); // Cooldown de 5s
        }).catch(error => {
            console.error("Erro na transa√ß√£o de trabalho:", error);
            document.getElementById('workMsg').textContent = `‚ùå Aguarde 5 segundos antes de trabalhar novamente.`;
            setTimeout(() => btnWork.disabled = false, 5000);
        });
    };
    
    // Transa√ß√£o de Admin (Dar/Remover Gold)
    document.getElementById('btnGive').addEventListener('click', () => {
        const adminName = document.getElementById('adminName').value;
        const adminAmount = parseInt(document.getElementById('adminAmount').value);

        if (auth.currentUser.uid !== OWNER_UID) return showGlobalNotice("Acesso negado.", 'var(--btn-red)');
        if (!adminName || isNaN(adminAmount) || adminAmount === 0) return alert("Preencha nome e valor v√°lido.");

        db.collection("users").where("displayName", "==", adminName).limit(1).get()
            .then(snapshot => {
                if (snapshot.empty) return alert("Usu√°rio n√£o encontrado.");
                const targetUid = snapshot.docs[0].id;
                
                return db.runTransaction(transaction => {
                    const userRef = db.collection('users').doc(targetUid);
                    return transaction.get(userRef).then(doc => {
                        const newGold = (doc.data().gold || 0) + adminAmount;
                        transaction.update(userRef, { gold: newGold });
                        showGlobalNotice(`Gold de ${adminName} alterado para ${newGold}.`, 'var(--btn-blue)');
                    });
                });
            })
            .catch(error => console.error("Erro na transa√ß√£o de Gold:", error));
    });

    // Fun√ß√£o de Notifica√ß√£o Global
    function showGlobalNotice(message, color = 'var(--main-gold)') {
        const notice = document.getElementById('globalNotice');
        notice.textContent = message;
        notice.style.backgroundColor = color;
        notice.style.display = 'block';
        
        notice.style.animation = 'none';
        void notice.offsetWidth; 
        notice.style.animation = 'fadeInOut 4.5s cubic-bezier(0.19, 1, 0.22, 1) forwards';
    }

    // Rastreamento de Visitantes Online
    function trackVisitor() {
        if (!auth.currentUser || auth.currentUser.isAnonymous) return; 
        
        const docRef = db.collection('visitors').doc(auth.currentUser.uid);
        docRef.set({ lastActive: serverTimestamp() }, { merge: true });

        const fiveMinutesAgo = new Date(Date.now() - 300000); 

        db.collection('visitors').where('lastActive', '>', fiveMinutesAgo).onSnapshot(snapshot => {
            document.getElementById('visitorCount').textContent = snapshot.size;
        });
    }

    // Placeholder para Amigos (Requer mais backend)
    window.loadFriendList = function() {
        // Esta √© uma fun√ß√£o placeholder, voc√™ precisaria de uma subcole√ß√£o 'friends' para funcionar de verdade.
        document.getElementById('friendList').innerHTML = '<p class="small" style="text-align: center;">Funcionalidade Social n√£o implementada no c√≥digo simples.</p>';
        document.getElementById('friendCount').textContent = '0';
    }

</script>
</body>
</html>
